{% extends 'Modulos.html' %}
{% block content %}
{% load static %}

<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Administrar Usuarios</title>
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="{% static 'css/ModuloAdministracion/Administracion.css' %}">
  <link rel="icon" type="image/x-icon" href="../static/imgs/logo.png">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
    $(document).ready(function() {
      $('.form-container form').hide();
    
      $('.toggle-button').click(function() {
        $(this).parent().next('form').slideToggle();
      });
    });
  </script>
</head>

<body>
  <div class="container">
    <h1>Administrar Usuarios</h1>

    <div class="form-container">
      <h2><button class="toggle-button btn btn-primary">☑</button>  Agregar Usuario</h2> 
      <form method="post" action="{% url 'crear_usuario' %}">
        {% csrf_token %}
        <label for="username">Nombre de usuario:</label>
        <input type="text" name="username" required>
        <label for="password">Contraseña:</label>
        <input type="password" name="password" required>
        <label for="is_superuser">Superusuario:</label>
        <input type="checkbox" name="is_superuser">
        <label for="first_name">Nombre:</label>
        <input type="text" name="first_name">
        <label for="last_name">Apellido:</label>
        <input type="text" name="last_name">
        <label for="email">Correo Electrónico:</label>
        <input type="email" name="email">
        <button type="submit">Crear Usuario</button>
      </form>
    </div>

    <div class="form-container">
      <h2><button class="toggle-button btn btn-primary">☑</button>  Editar Usuario</h2>
      <form method="post" action="">
        {% csrf_token %}
        <label for="user">Selecciona un usuario:</label>
        <select name="user">
          {% for user in users %}
            <option value="{{ user.id }}" {% if user.id == selected_user.id %}selected{% endif %}>{{ user.username }}</option>
          {% endfor %}
        </select>
        <label for="new_password">Nueva Contraseña:</label>
        <input type="password" name="new_password">
        <label for="is_superuser">Superusuario:</label>
        <input type="checkbox" name="is_superuser" {% if selected_user.is_superuser %}checked{% endif %}>
        <label for="first_name">Nombre:</label>
        <input type="text" name="first_name">
        <label for="last_name">Apellido:</label>
        <input type="text" name="last_name">
        <label for="email">Correo Electrónico:</label>
        <input type="email" name="email">
        <button type="submit">Guardar Cambios</button>
      </form>
    </div>

    <div class="form-container">
      <h2><button class="toggle-button btn btn-primary">☑</button>  Deshabilitar Usuario</h2>
      <form method="post" action="{% url 'deshabilitar_usuario' %}">
        {% csrf_token %}
        <label for="username">Nombre de usuario a deshabilitar:</label>
        <input type="text" name="username" required>
        <button type="submit">Deshabilitar Usuario</button>
      </form>
    </div>

    <div class="form-container">
      <h2><button class="toggle-button btn btn-primary">☑</button>  Habilitar Usuario</h2>
      <form method="post" action="{% url 'habilitar_usuario' %}">
        {% csrf_token %}
        <label for="username">Nombre de usuario a habilitar:</label>
        <input type="text" name="username" required>
        <button type="submit">Habilitar Usuario</button>
      </form>
    </div>

    <div class="list-container">
      <h2>Listado de Usuarios</h2>
      <ul>
        {% for user in users %}
          <li>
            Usuario: {{ user.username }} <br>
            Nombre: {{ user.first_name }} <br>
            Apellido: {{ user.last_name }} <br>
            {% if user.is_active %}
            Estado:(Activo)<br>
            {% else %}
            Estado:  (Deshabilitado)<br>
            {% endif %}
            {% if user.is_superuser %}
              (Superusuario)<br>
            {% endif %}
            {% if user.last_login %}
              Última conexión: {{ user.last_login }}
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>
</body>

{% endblock %}
</html>
